<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>来写一个简单的解释器（二）</title>
    <meta name="description" content="翻译自 Ruslan&#39;s Blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.b29def48.css" as="style"><link rel="preload" href="/assets/js/app.717ac4b4.js" as="script"><link rel="preload" href="/assets/js/4.aa840ed2.js" as="script"><link rel="preload" href="/assets/js/10.5d7ef6af.js" as="script"><link rel="preload" href="/assets/js/21.b050a957.js" as="script"><link rel="prefetch" href="/assets/js/1.313c18d5.js"><link rel="prefetch" href="/assets/js/11.de5f5a83.js"><link rel="prefetch" href="/assets/js/12.10ac87ad.js"><link rel="prefetch" href="/assets/js/13.9fe55a35.js"><link rel="prefetch" href="/assets/js/14.e3409dbe.js"><link rel="prefetch" href="/assets/js/15.d7af864a.js"><link rel="prefetch" href="/assets/js/16.3ff36eac.js"><link rel="prefetch" href="/assets/js/17.607f4db9.js"><link rel="prefetch" href="/assets/js/18.9fcb92ba.js"><link rel="prefetch" href="/assets/js/19.b13e92aa.js"><link rel="prefetch" href="/assets/js/20.8cc4e298.js"><link rel="prefetch" href="/assets/js/22.4f7b79ed.js"><link rel="prefetch" href="/assets/js/23.c6e1b0bd.js"><link rel="prefetch" href="/assets/js/5.3726f07c.js"><link rel="prefetch" href="/assets/js/6.dc60ba74.js"><link rel="prefetch" href="/assets/js/7.a61a8008.js"><link rel="prefetch" href="/assets/js/8.9570863a.js"><link rel="prefetch" href="/assets/js/9.bc71f555.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.418f9a64.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b29def48.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuperess-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">
        </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">主页</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">
      </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">主页</a></li></ul></div></div></div> <div class="content-wrapper"><div><div class="content__default"><h1 id="来写一个简单的解释器（二）"><a href="#来写一个简单的解释器（二）" class="header-anchor">#</a> 来写一个简单的解释器（二）</h1> <p>在一本有趣的书————《有用思维的五要素》中，作者Burger和 Starbird分享了他们如何观察Tony Plig，一个国际知名的小号演奏家，为优秀的小号演奏者开了一个大师班的故事。学生们首先演奏复杂的音乐短句，并且他们演奏的非常好。但后来他们被要求演奏非常基础、简单的音符。当他们演奏音符时候，与先前的复杂短句相比，这些音符显得十分幼稚。他们完成演奏后，老师也演奏了相同的音符，但是当他演奏的时候，却不显得幼稚。差异让人惊讶。Tony解释说，掌握简单的音符能够让人更好的控制复杂的曲子。这个例子很明确————想要掌握精湛的技术，必须注重简单、基础的思想。</p> <p>故事中的启示不仅仅适用于音乐，也适用于软件开发。这个故事提醒我们不要忽视在基础、简单的想法上埋工夫的重要性。即使有时候干这些事情像是在退步。虽然熟练使用您使用的工具或者框架非常重要，但是其背后的原理也非常重要。</p> <blockquote><p>“如果你只学习方法，那么你只会方法；但如果你学习原理，那么你可以定义你自己的方法。”</p></blockquote> <p>话题转回来，我们继续深入研究解释器和编译器。</p> <p>今天，我将给你展示第一章中计算器的新版本，这个版本更够：</p> <ol><li><p>处理字符串中任何位置的空白字符</p></li> <li><p>从输入中处理多位整数</p></li> <li><p>支持减法（之前目前只能加法）</p></li></ol> <p>以下是新版的源代码，可以执行以上所有操作</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token constant">INTEGER</span> <span class="token operator">=</span> <span class="token string">'INTEGER'</span>
<span class="token keyword">const</span> <span class="token constant">PLUS</span> <span class="token operator">=</span> <span class="token string">'PLUS'</span>
<span class="token keyword">const</span> <span class="token constant">MINUS</span> <span class="token operator">=</span> <span class="token string">'MINUS'</span>
<span class="token keyword">const</span> <span class="token constant">EOF</span> <span class="token operator">=</span> <span class="token string">'EOF'</span>

<span class="token keyword">class</span> <span class="token class-name">Token</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span>
  value<span class="token punctuation">:</span> <span class="token builtin">any</span>

  <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token keyword">type</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
  <span class="token punctuation">}</span>

  <span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Token(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Interpreter</span> <span class="token punctuation">{</span>
  text<span class="token punctuation">:</span> <span class="token builtin">string</span>
  pos<span class="token punctuation">:</span> <span class="token builtin">number</span>
  currentToken<span class="token punctuation">:</span> Token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">EOF</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  currentChar<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span>

  <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  error <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">never</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Error parsing input'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">advance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token operator">++</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">skipWhitespace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">===</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">integer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token regex">/[0-9]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  getNextToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">Token</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/ /</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">skipWhitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/[0-9]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">===</span> <span class="token string">'+'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">PLUS</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">===</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">MINUS</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">EOF</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenType<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentToken<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> tokenType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getNextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">expr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getNextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> op <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken
    <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token constant">PLUS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">PLUS</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">MINUS</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token constant">PLUS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> left<span class="token punctuation">.</span>value <span class="token operator">+</span> right<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> left<span class="token punctuation">.</span>value <span class="token operator">-</span> right<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后我们的测试变成了这样</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Interpreter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../src'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Unit test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Interpreter run success'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Interpreter</span><span class="token punctuation">(</span><span class="token string">'1+2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Interpreter</span><span class="token punctuation">(</span><span class="token string">'1+9'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Interpreter</span><span class="token punctuation">(</span><span class="token string">'20+20'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Interpreter</span><span class="token punctuation">(</span><span class="token string">'20-20'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Interpreter</span><span class="token punctuation">(</span><span class="token string">'1-2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>与第一版相比，主要的代码变成了：</p> <ol><li><p>方法<code>getNextToken</code>方法稍微重构了一下，增加pos指针的逻辑被抽象到了新的方法<code>advance</code></p></li> <li><p>增添了两个新方法，<code>skipWhitespace</code>用于忽略空格字符，<code>integer</code>用于处理多位整数</p></li> <li><p>除了 INTEGER -&gt; PLUS -&gt; INTEGER 之外，我们还增加了 INTEGER -&gt; MINUS -&gt; INREGER 短语。现在还能成功的识别加法或者减法</p></li></ol> <p>在第一部分，您学习了两个重要的概念，Token和词法分析器。</p> <p>今天我想谈谈Lexemes、parsing和parsers。</p> <p>你已经知道了Token。但是为了让我们完成对Token的讨论，我们需要谈一谈Lexemes。</p> <p>什么是Lexeme？</p> <p>Lexeme是一系列形成Token的字符。在下面的图片中，您可以看到Token和lexemes的一些例子，希望它能使它们之间的关系变得清晰一点：</p> <p><img src="https://ruslanspivak.com/lsbasi-part2/lsbasi_part2_lexemes.png" alt=""></p> <p>现在，还记得我们的老朋友，<code>expr</code>方法吗？</p> <p>我之前说过，这就是算术表达式实际发生的地方。但在你解析一个表达式之前，你首先要识别出它们是什么类型的短语，例如，它是加法，还是减法。</p> <p>这就是<code>expr</code>方法的本质工作：他从<code>getNextToken</code>方法中获取标记流中的结构，然后解释已经识别的短语，生成算术表达式。</p> <p>在Token流查找结构的过程，或换句话说，识别Token流的短语的过程称作解析（Parsing）。执行该工作的解释器或编译器的一部分乘坐解析器（Parser）。</p> <p>所以，你现在知道了<code>expr</code>方法是你的解释器的一部分，它同时解析和解释句子。</p> <p><code>expr</code>方法首先尝试解析 INTEGER - &gt; PLUS - &gt; INTEGER或INTEGER - &gt; MINUS - &gt; INTEGER短语的Token流，并在识别成功后将加法或减法的结果返回给调用者。</p> <p>然后，又到了练习时间。</p> <p><img src="https://ruslanspivak.com/lsbasi-part2/lsbasi_part2_exercises.png" alt=""></p> <ol><li><p>扩展两位数的乘法</p></li> <li><p>扩展两位数的除法</p></li> <li><p>修改代码，支持任意数量的加法或减法。例如“9-5+3 + 11”</p></li></ol> <p>检查你的理解：</p> <ol><li><p>啥是Lexeme？</p></li> <li><p>Token流中查找结构的进程名称是什么？</p></li> <li><p>解析Token流的部分叫什么？</p></li></ol> <p>下一节，我们会扩展更复杂的算术表达式。敬请期待。</p></div></div></div> <footer class="footer" data-v-0d113134><div class="footer-left-wrap" data-v-0d113134><ul class="contact" data-v-0d113134><li class="contact-item" data-v-0d113134><a href="https://github.com/himself65" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-0d113134><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-0d113134><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-0d113134></path></svg>
          
        </a></li><li class="contact-item" data-v-0d113134><a href="https://github.com/himself6565" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-0d113134><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-0d113134><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-0d113134></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-0d113134><ul class="copyright" data-v-0d113134></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.717ac4b4.js" defer></script><script src="/assets/js/4.aa840ed2.js" defer></script><script src="/assets/js/10.5d7ef6af.js" defer></script><script src="/assets/js/21.b050a957.js" defer></script>
  </body>
</html>
