<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>来写一个简单的解释器（四）</title>
    <meta name="description" content="翻译自 Ruslan&#39;s Blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.b29def48.css" as="style"><link rel="preload" href="/assets/js/app.a36a2ce8.js" as="script"><link rel="preload" href="/assets/js/4.aa840ed2.js" as="script"><link rel="preload" href="/assets/js/10.5d7ef6af.js" as="script"><link rel="preload" href="/assets/js/18.9fcb92ba.js" as="script"><link rel="prefetch" href="/assets/js/1.313c18d5.js"><link rel="prefetch" href="/assets/js/11.de5f5a83.js"><link rel="prefetch" href="/assets/js/12.10ac87ad.js"><link rel="prefetch" href="/assets/js/13.7f3af8ae.js"><link rel="prefetch" href="/assets/js/14.9a58a723.js"><link rel="prefetch" href="/assets/js/15.b0a3dc09.js"><link rel="prefetch" href="/assets/js/16.3ff36eac.js"><link rel="prefetch" href="/assets/js/17.607f4db9.js"><link rel="prefetch" href="/assets/js/19.b13e92aa.js"><link rel="prefetch" href="/assets/js/20.8cc4e298.js"><link rel="prefetch" href="/assets/js/21.b050a957.js"><link rel="prefetch" href="/assets/js/22.4f7b79ed.js"><link rel="prefetch" href="/assets/js/23.c6e1b0bd.js"><link rel="prefetch" href="/assets/js/5.3726f07c.js"><link rel="prefetch" href="/assets/js/6.dc60ba74.js"><link rel="prefetch" href="/assets/js/7.a61a8008.js"><link rel="prefetch" href="/assets/js/8.9570863a.js"><link rel="prefetch" href="/assets/js/9.bc71f555.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.418f9a64.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b29def48.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuperess-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">
        </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">主页</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">
      </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">主页</a></li></ul></div></div></div> <div class="content-wrapper"><div><div class="content__default"><h1 id="来写一个简单的解释器（四）"><a href="#来写一个简单的解释器（四）" class="header-anchor">#</a> 来写一个简单的解释器（四）</h1> <p>你是否在被动的学习这些文章种的内容？或是主动的学习？我希望你一直是主动的、积极的练习它。（真的）</p> <p>还记得孔子说过的话吗？</p> <blockquote><p>「不聞不若聞之，聞之不若見之，見之不若知之，知之不若行之；學至于行之而止矣。」</p></blockquote> <blockquote><p>英文：“I hear and I forget. I see and I believe. I do and I understand.”</p></blockquote> <p><img src="https://ruslanspivak.com/lsbasi-part4/LSBAWS_confucius_hear.png" alt=""></p> <p><img src="https://ruslanspivak.com/lsbasi-part4/LSBAWS_confucius_see.png" alt=""></p> <p><img src="https://ruslanspivak.com/lsbasi-part4/LSBAWS_confucius_do.png" alt=""></p> <p>在之前的文章里，你已经学习了如何解析和解释任意个整数的加减计算表达式，比如“7 - 3 + 2 - 1”。你也学到了有关语法图和如何使用它们来描述编程语言的语法。</p> <p>今天，你将要学到如何去解析解释任意个整数的乘除计算表达式，比如“7 * 4 / 2 * 3”。本章将划分的是整数除法，所以“9 / 4”，结果会是“2”。</p> <p>我也会谈一谈另一个广泛使用的，用于指定编程语言的语法的表示法————上下文无关语法（context-free grammars），简称语法（grammars）或者 BNF（Backus-Naur Form）。出于本文的目的，我不会使用纯的BNF表示法，而是像修改过的EBNF表示法。</p> <p>用这种语法的几个原因：</p> <ol><li><p>grammar以简洁的方式指定编程语言语法。与语法图不同，语法非常的紧凑。您将在以后的文章中看到我越来越多的使用这种语法。</p></li> <li><p>grammar可以作为很好的文档。</p></li> <li><p>即使你从头开始写编译器，grammar也是一个很好的开始。通常，您可以通过遵循一组简单的规则将语法转换为代码。</p></li> <li><p>有一种工具，称作解析器生成器，它们接受语法作为输入，然后根据语法自动生成解析器。本文将在最后讨论这些工具。</p></li></ol> <p>现在，让我们开始讨论语法的机械方面吧？</p> <p>这是一个描述算术表达式的语法，如“7 * 4 / 2 * 3”（它只是语法可以被生成的种多表达式之一）</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf1.png" alt=""></p> <p>语法由一系列规则组成，称作产生式（productions）。我们语法中，有两条规则：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf2.png" alt=""></p> <p>规则包括非终结符式（non-terminal），称作产生式的头或左侧，冒号，以及一些列终结符或非终结符，称作正文或右侧。</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf3.png" alt=""></p> <p>在我上面显示的语法中，像MUL、DIV、和INTEGER这样的标记称作终端，而像<code>expr</code>、<code>factor</code>这样的变量称作非终结符。非终结符通常是由一些列终结符和非终结符组成：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf4.png" alt=""></p> <p>第一个规则左侧的非终结符号称作起始符号。</p> <p>在我们的语法下，开始符号是<code>expr</code>：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf5.png" alt=""></p> <p>您可以将规则<code>expr</code>理解成：“expr可以是一个因子，后面可选的跟着乘法或者除法运算符后跟一个因子，然后可选地后面跟乘法或者除法后跟一个因子，以此类推。”</p> <p>什么是因子（factor）呢？出于本文目的，因子只是一个整数。</p> <p>所以我们快速浏览一下我们语法中的符号和意义。</p> <ul><li><p>| - 备选方案。意思是“或”。（MUL | DIV） 意思是或者MUL或者DIV</p></li> <li><p>( ... ) - 开闭括号表示如（MUL | DIV）中的终结或非终结字符的分组</p></li> <li><p>( ... )* - 表示将里面的内容多次匹配</p></li></ul> <blockquote><p>译者注： 这就是个正则表达式</p></blockquote> <p>如果你以前使用过正则表达式，那么这些符号对你来说应该非常熟悉</p> <p>语法通过解释它可以形成的句子来定义语言。</p> <p>这就是你如何使用语法派生算术表达式；首先从符号<code>expr</code>开始，然后用非终结符的规则重复替换非终结，知道你生成一个包含终结的句子为止。</p> <p>这些句子构成的语法而定义语言。</p> <p>如果语法无法派生某个算术表达式，则它不支持该表达式，并且解析器在尝试识别表达式的时候将产生语法错误。我认为有几个例子是有序的。这就是语法产生3的方式：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_derive1.png" alt=""></p> <p>这是如何产生“3*7”的：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_derive2.png" alt=""></p> <p>这是如何产生“3 * 7 / 2”的：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_derive3.png" alt=""></p> <p>哇。这么多的理论。</p> <p>我想，当我第一次阅读有关语法的相关术语和所有爵士乐内容时，我的感觉像这样：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf_hmm.png" alt=""></p> <p>我敢保证，我不是这样：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf_yes.png" alt=""></p> <p>我花了一些时间来熟悉符号是如何工作的，以及它与解析器和词法分析器的关系，但我必须告诉你，从长远来看，它是值得的，因为它在实践和编译器文献中被广泛使用。你肯定会在某些时候遇到它。那么，为什么不早点呢？</p> <p>现在，让我们把语法映射到代码。</p> <p>以下是我们将用于将语法糖转换为源代码的原则。
通过遵循它们，您可以直接将语法翻译成工作解析器：</p> <ol><li><p>在语法定义的每个规则R成为具有相同名称的方法，并且对该规则的应用方法调用：R()。该方法遵循规则主体的流动，并且遵循相同的指导方针。</p></li> <li><p>(a1 | a2 | an) 变成 if-else-then 语法。</p></li> <li><p>可选分组 (...)* 变成零次或多次的 while 循环</p></li> <li><p>每个Token引用T，调用方法<code>eat</code>：<code>eat(T)</code>。
eat方法的工作方式是，他会用标记T，然后从词法分析器中获取一个新的标记，并且将该标记分配给 currentToken 内部变量</p></li></ol> <p>用图来说，就是这样的：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_rules.png" alt=""></p> <p>让我们根据上面的指南将语法转换为代码。</p> <p>我们语法中有两条规则：一条expr和一条因子规则。</p> <p>根据指南，您需要创建一个名为factor（规则1）的方法，该方法只需调用<code>eat</code>方法来使用INTEGER Token（规则4）：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function-variable function">factor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span>
</code></pre></div><p>很简单，对吧？</p> <p>规则<code>expr</code>成为<code>expr</code>方法（同样根据指南1）。
规则的主体以对<code>factor</code>成为<code>factor()</code>方法调用引用开始。
可选分组 (...)* 成为while循环，(MUL|DIV) 变成if-else-then语句。</p> <p>通过组合这些部分，我们得到了以下<code>expr</code>方法：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token function-variable function">expr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">MUL</span><span class="token punctuation">,</span> <span class="token constant">DIV</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentToken<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken
      <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token constant">MUL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">MUL</span><span class="token punctuation">)</span>
        result <span class="token operator">*=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token constant">DIV</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">DIV</span><span class="token punctuation">)</span>
        result <span class="token operator">/=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
</code></pre></div><p>请花一些时间研究如何将语法映射到代码。确保你理解那些部分，稍后会派上用场。</p> <p>我忍不住再提一下语法树，这是同一个<code>expr</code>规则的语法图的样子：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_sd.png" alt=""></p> <p>现在是我们挖掘新的算术表达式解释器的源代码的时候了。
下面是一个计算器的代码，它可以处理包含整数和任意数量的乘法除法（整数除法）运算符的表达式。
您还可以看到我将词法分析器重构成了单独的类Lexer并更新了Interpreter类并将Lexer实例作为成员参数：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token constant">INTEGER</span> <span class="token operator">=</span> <span class="token string">'INTEGER'</span>
<span class="token keyword">const</span> <span class="token constant">MUL</span> <span class="token operator">=</span> <span class="token string">'MUL'</span>
<span class="token keyword">const</span> <span class="token constant">DIV</span> <span class="token operator">=</span> <span class="token string">'DIV'</span>
<span class="token keyword">const</span> <span class="token constant">EOF</span> <span class="token operator">=</span> <span class="token string">'EOF'</span>

<span class="token keyword">class</span> <span class="token class-name">Token</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span>
  value<span class="token punctuation">:</span> <span class="token builtin">any</span>

  <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token keyword">type</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
  <span class="token punctuation">}</span>

  <span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Token(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Lexer</span> <span class="token punctuation">{</span>
  text<span class="token punctuation">:</span> <span class="token builtin">string</span>
  pos<span class="token punctuation">:</span> <span class="token builtin">number</span>
  currentToken<span class="token punctuation">:</span> Token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">EOF</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  currentChar<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span>

  <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  error <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">never</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid character'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">advance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token operator">++</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">skipWhitespace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">===</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">integer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token regex">/[0-9]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentChar
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  getNextToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">Token</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/ /</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">skipWhitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/[0-9]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">===</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">MUL</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentChar <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">DIV</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Token</span><span class="token punctuation">(</span><span class="token constant">EOF</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Interpreter</span> <span class="token punctuation">{</span>
  lexer<span class="token punctuation">:</span> Lexer
  currentToken<span class="token punctuation">:</span> Token

  <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lexer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lexer</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lexer<span class="token punctuation">.</span><span class="token function">getNextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  error <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">never</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid syntax'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenType<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentToken<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> tokenType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lexer<span class="token punctuation">.</span><span class="token function">getNextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">factor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> token<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>

  <span class="token function-variable function">expr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">MUL</span><span class="token punctuation">,</span> <span class="token constant">DIV</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentToken<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentToken
      <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token constant">MUL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">MUL</span><span class="token punctuation">)</span>
        result <span class="token operator">*=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token constant">DIV</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token constant">DIV</span><span class="token punctuation">)</span>
        result <span class="token operator">/=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我知道你等不及了这部分:)  这是今天的新练习：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_exercises.png" alt=""></p> <ul><li><p>编写一个描述任意数量 +, -, *, / 运算符的算术表达式语法。
通过gramma，你应该能够推导出“2 + 7 * 4”，“7 - 8 / 4”，“14 + 2 * 3 - 6 / 2”等表达式</p></li> <li><p>使用grammar，编写解释器，要求和上一条一样</p></li> <li><p>如果你已经完成了上述练习，放松并欣赏:)</p></li></ul> <p>检查你的理解。</p> <p>记住今天文章中的语法，回答下列问题，根据需要参考下图：</p> <p><img src="https://ruslanspivak.com/lsbasi-part4/lsbasi_part4_bnf1.png" alt=""></p> <ol><li><p>什么是上下文无关语法？</p></li> <li><p>语法有多少规则？</p></li> <li><p>什么是终结符？（找到图中所有的）</p></li> <li><p>什么是非终结符？（同上）</p></li> <li><p>什么是规则的头？</p></li> <li><p>什么是规则的正文？</p></li> <li><p>什么是语法的起始符号？</p></li></ol> <p>敬请期待下一章。</p></div></div></div> <footer class="footer" data-v-0d113134><div class="footer-left-wrap" data-v-0d113134><ul class="contact" data-v-0d113134><li class="contact-item" data-v-0d113134><a href="https://github.com/himself65" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-0d113134><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-0d113134><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-0d113134></path></svg>
          
        </a></li><li class="contact-item" data-v-0d113134><a href="https://github.com/himself6565" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-0d113134><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-0d113134><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-0d113134></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-0d113134><ul class="copyright" data-v-0d113134></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a36a2ce8.js" defer></script><script src="/assets/js/4.aa840ed2.js" defer></script><script src="/assets/js/10.5d7ef6af.js" defer></script><script src="/assets/js/18.9fcb92ba.js" defer></script>
  </body>
</html>
